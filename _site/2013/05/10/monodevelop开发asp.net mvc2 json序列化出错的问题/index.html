<hr />

<p>author: LeoPan
comments: true
date: 2013-05-10 16:18:10+00:00
layout: post
slug: monodevelop开发asp.net-mvc2-json序列化出错的问题
title: MonoDevelop开发ASP.NET MVC2 JSON序列化出错的问题
wordpress_id: 590
categories:
- ASP.NET
- MONO
- Study Note
tags:
- ASP.NET</p>

<h2>- MONO</h2>

<h3>PS:我知道在Linux上写C# ASP.NET是很反人类的事</h3>

<p>Mono 版本 2.10.9-1</p>

<p>简单的ASP.NET MVC2的程序
前台框架:Extjs</p>

<p>关键代码</p>

<!-- more -->


<p><code>
//UserController简单代码
public ActionResult getUser(){
    User user = new User (a,b,c);
    JavaScriptSerializer serializer = new JavaScriptSerializer();
    String strJson = serializer.Serialize(user);
    return Json(strJson,JsonRequestBehavior.AllowGet);
}
</code></p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//Extjs Model中简单代码</span>
<span class="nx">Ext</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;leo.model.User&#39;</span><span class="p">,{</span>
    <span class="nx">extend</span><span class="o">:</span> <span class="s1">&#39;Ext.data.Model&#39;</span><span class="p">,</span>
    <span class="nx">fields</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">],</span>




    
    <span class="o">&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="nx">proxy</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;ajax&#39;</span><span class="p">,</span>
        <span class="nx">api</span><span class="o">:</span><span class="p">{</span>
            <span class="nx">read</span><span class="o">:</span><span class="s1">&#39;/User/getUser&#39;</span>
        <span class="p">}</span> <span class="p">,</span> 
        <span class="nx">reader</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;json&#39;</span>
        <span class="p">},</span>  
    <span class="p">}</span>
    <span class="o">&lt;</span><span class="err">/code&gt;</span>





<span class="p">})</span></code></pre></div>


<p>当请求发送至后台,后台返回json数据的时候出现错误(###在vs2010下正常)
<code>(Cannot cast from source type to destination type)
at System.Web.Script.Serialization.JavaScriptSerializer..ctor (System.Web.Script.Serialization.JavaScriptTypeResolver resolver, Boolean registerConverters) [0x0000d] in /build/mono/src/mono-2.10.9/mcs/class/System.Web.Extensions/System.Web.Script.Serialization/JavaScriptSerializer.cs:66
at System.Web.Script.Serialization.JavaScriptSerializer..cctor () [0x00000] in &lt;filename unknown&gt;:0</code></p>

<ul>
<li>分析:
在程序启动后,MonoDevelop应用程序输出中发现System.Web.Extensions 4.0.0.0已经加载了
<a href="http://www.leopan.me/wp-content/uploads/2013/05/2013-05-11-000530_1091x668_scrot.png"><img src="http://www.leopan.me/wp-content/uploads/2013/05/2013-05-11-000530_1091x668_scrot.png" alt="2013-05-11-000530_1091x668_scrot" /></a></li>
</ul>


<p><code>Loaded assembly: ..../System.Web.Extensions/4.0.0.0__31bf3856ad364e35/System.Web.Extensions.dll</code></p>

<p>可是当请求Controller时,程序又加载了一遍System.Web.Extensions,不过这次是3.5.0.0
<code>Loaded assembly: ..../System.Web.Extensions/3.5.0.0__31bf3856ad364e35/System.Web.Extensions.dll</code></p>

<p>于是就知道基本上是冲突了吧.</p>

<ul>
<li>解决方法
在web.config中配置下绑定System.Web.Extensions不指向3.5.0.0即可</li>
</ul>


<h3>PPS: 此处web.config 不是Views视图中的web.config 而是整个解决方案中的Web.config.</h3>

<p>最后,发现我根本就可以不需要用JavaScriptSerializer,不过解决问题总是好的.</p>
